import numpy as np
import re

# Parse the coordinate data from the provided text
def parse_coordinates(data_text):
    """
    Parses comma-separated coordinate data with a header.
    Each line is expected to be in 'Index,X,Y' format.
    """
    coordinates = []
    lines = data_text.strip().split('\n')
    # Skip the header line
    for line in lines[1:]:
        parts = line.strip().split(',')
        # Expects at least 3 parts (Index, X, Y)
        if len(parts) >= 3:
            try:
                # Use parts[1] for X and parts[2] for Y
                x = float(parts[1])
                y = float(parts[2])
                coordinates.append((x, y))
            except (ValueError, IndexError):
                # Ignore lines that cannot be properly parsed
                continue
    return coordinates

# Process coordinates with FFT filtering
def process_coordinates(coordinates, cutoff_freq=0.1):
    """
    Applies a low-pass filter to the coordinates using FFT.
    This helps to smooth the shape defined by the points.
    """
    # Convert to complex signal (x + j*y)
    x = np.array([p[0] for p in coordinates])
    y = np.array([p[1] for p in coordinates])
    z = x + 1j * y
    
    # Apply Fast Fourier Transform
    Z = np.fft.fft(z)
    freqs = np.fft.fftfreq(len(z))
    
    # Create a low-pass filter mask to remove high-frequency noise
    mask = np.abs(freqs) <= cutoff_freq
    Z_filtered = Z * mask
    
    # Apply Inverse FFT to get the filtered signal
    z_filtered = np.fft.ifft(Z_filtered)
    x_filtered = np.real(z_filtered)
    y_filtered = np.imag(z_filtered)
    
    return x_filtered, y_filtered

# Scale coordinates for a 12-bit DAC (Digital-to-Analog Converter)
def scale_for_dac(x, y):
    """
    Scales the x and y coordinates to fit within a 12-bit range (0-4095).
    This is necessary for outputting the analog signal on hardware like an STM32.
    """
    # Find min/max values for scaling to maintain aspect ratio
    x_min, x_max = np.min(x), np.max(x)
    y_min, y_max = np.min(y), np.max(y)
    
    # Scale to 12-bit unsigned integer range [0, 4095]
    x_dac = np.round((x - x_min) / (x_max - x_min) * 4095).astype(np.uint16)
    y_dac = np.round((y - y_min) / (y_max - y_min) * 4095).astype(np.uint16)
    
    return x_dac, y_dac

# Generate a C header file for an STM32 project
def generate_stm32_header(x_dac, y_dac, filename="arrow_data.h"):
    """
    Generates a .h file containing the scaled coordinate data as C arrays.
    """
    with open(filename, 'w') as f:
        f.write("// Generated by Python script\n")
        f.write("#ifndef ARROW_DATA_H\n")
        f.write("#define ARROW_DATA_H\n\n")
        f.write("#include <stdint.h>\n\n")
        f.write(f"#define ARROW_POINTS {len(x_dac)}\n\n")
        
        # Write X coordinates array
        f.write("const uint16_t arrow_x[ARROW_POINTS] = {\n    ")
        # Format with 12 values per line for readability
        f.write(", ".join(map(str, x_dac)))
        f.write("\n};\n\n")
        
        # Write Y coordinates array
        f.write("const uint16_t arrow_y[ARROW_POINTS] = {\n    ")
        # Format with 12 values per line for readability
        f.write(", ".join(map(str, y_dac)))
        f.write("\n};\n\n#endif // ARROW_DATA_H\n")

# Main processing block
# The data from 'drawing_coordinates.csv' is placed directly into this string.
data_text = """Index,X,Y
0,63.0,187.0
1,64.2674116222515,186.5775294592495
2,65.53482324450299,186.155058918499
3,66.84562979911529,186.0
4,68.12096319095546,185.62634560301484
5,69.38837481320697,185.20387506226436
6,70.48879434946913,184.51120565053088
7,71.43346719707834,183.56653280292167
8,72.50732810696171,182.83089063101278
9,73.7747397292132,182.40842009026227
10,75.0421513514647,181.98594954951176
11,76.30956297371618,181.56347900876128
12,77.57697459596768,181.14100846801077
13,78.71204897984762,180.46596326511428
14,79.78082430232327,179.66438177325756
15,80.84959962479891,178.8628002814008
16,81.91837494727456,178.06121878954409
17,83.10366755358434,177.44816622320783
18,84.29859469044925,176.85070265477538
19,85.49352182731415,176.25323908634292
20,86.54426669489737,175.45573330510263
21,87.48893954250657,174.51106045749341
22,88.54848110977414,173.7257594451129
23,89.74340824663905,173.12829587668048
24,90.93833538350395,172.53083230824802
25,92.10535327277503,171.89464672722497
26,93.05002612038425,170.94997387961575
27,93.99469896799346,170.00530103200654
28,95.06277788938907,169.2029165829582
29,96.13155321186471,168.40133509110146
30,97.20032853434036,167.59975359924474
31,98.186589952726,166.720115070911
32,98.9276523040984,165.6085215438524
33,99.66871465547081,164.4969280167938
34,100.52236523852879,163.4776347614712
35,101.467038086138,162.53296191386198
36,102.46579774902608,161.65065168823043
37,103.53457307150173,160.8490701963737
38,104.60334839397737,160.04748870451698
39,105.67212371645302,159.24590721266023
40,106.51372105284601,158.22941842073098
41,107.25478340421841,157.11782489367238
42,107.99584575559082,156.00623136661378
43,108.73690810696323,154.89463783955514
44,109.47797045833563,153.78304431249654
45,110.27921314270458,152.72078685729542
46,111.22388599031379,151.7761140096862
47,112.168558837923,150.831441162077
48,113.08882624216704,149.86676063674943
49,113.82988859353944,148.75516710969083
50,114.57095094491184,147.64357358263223
51,115.39774047156345,146.60225952843655
52,116.34241331917265,145.65758668082734
53,117.28708616678186,144.71291383321815
54,118.19665404481243,143.73779460691674
55,118.99823553666918,142.6690192844411
56,119.79981702852591,141.60024396196545
57,120.60139852038265,140.53146863948982
58,121.47491649889517,139.52508350110483
59,122.41958934650438,138.58041065349562
60,123.36426219411359,137.6357378058864
61,124.3089350417228,136.6910649582772
62,125.253607889332,135.74639211066798
63,126.08867384128587,134.7339784761424
64,126.51114438203636,133.46656685389092
65,126.93361492278686,132.19915523163942
66,127.9369228340623,131.3753847772918
67,129.0485163611209,130.6343224259194
68,130.08605647910363,129.82788704179274
69,130.68352004753606,128.63295990492784
70,131.5227759234586,127.65148271769426
71,132.6343694505172,126.91042036632187
72,133.7459629775758,126.16935801494947
73,134.46092277160616,125.07815445678767
74,135.09231690938157,123.90768309061843
75,136.03698975699078,122.96301024300922
76,136.9816626046,122.01833739540001
77,137.9263354522092,121.07366454779081
78,138.8710082998184,120.12899170018159
79,139.81568114742763,119.18431885257237
80,140.76035399503684,118.23964600496318
81,141.70502684264605,117.29497315735395
82,142.29055453447427,116.12833639657721
83,142.71302507522475,114.86092477432572
84,143.30297740797388,113.69702259202613
85,144.35023035017076,113.0
86,145.30687774708557,112.38624450582886
87,145.90434131551802,111.19131736896395
88,146.12206983195466,110.0
89,146.6761175276239,110.3238824723761
90,145.73144468001468,111.26855531998531
91,144.86514266581943,112.26971466836112
92,144.267679097387,113.46464180522602
93,143.3404310579091,114.32978447104546
94,142.14550392104417,114.92724803947792
95,141.3491753497696,115.97623697534557
96,140.60811299839722,117.08783050240419
97,139.830522163715,118.169477836285
98,138.88584931610578,119.11415068389422
99,137.94117646849656,120.05882353150344
100,136.99650362088735,121.00349637911263
101,136.05183077327814,121.94816922672186
102,135.4353170908569,123.12936581828622
103,134.83785352242444,124.32429295515111
104,134.24038995399198,125.51922009201603
105,133.4354170430097,126.56458295699031
106,132.49074419540048,127.50925580459953
107,131.54607134779124,128.45392865220876
108,130.60139850018206,129.39860149981794
109,130.0,130.48546323774627
110,130.0,131.82143239084084
111,129.35798913646767,132.9630162952985
112,128.61692678509525,134.0746098223571
113,127.92923183897501,135.21230448307497
114,127.50676129822452,136.47971610532645
115,127.08429075747401,137.74712772757795
116,126.74062794629096,139.0374882148362
117,126.4166078327159,140.3335686691364
118,126.09258771914085,141.62964912343662
119,125.57325975013124,142.85348049973751
120,124.98288531594861,144.05134405215418
121,124.5604147751981,145.3187556744057
122,124.1379442344476,146.58616729665718
123,123.7154736936971,147.85357891890868
124,123.29300315294661,149.12099054116018
125,122.9007030463569,150.39718781457245
126,122.57668293278184,151.69326826887266
127,122.25266281920679,152.98934872317284
128,121.90696147098514,154.2791155870446
129,121.48449093023463,155.5465272092961
130,121.06202038948415,156.81393883154757
131,120.63954984873364,158.08135045379908
132,120.21707930798314,159.3487620760506
133,119.63971994441206,160.54042008338192
134,118.89865759303966,161.65201361044052
135,118.15759524166727,162.7636071374991
136,118.0,164.05186029079434
137,118.0,165.3878294438889
138,118.0,166.72379859698344
139,117.41214662107856,167.88178006838217
140,116.67108426970616,168.99337359544077
141,115.9694029713866,170.12238811445363
142,115.64538285781154,171.41846856875384
143,115.3213627442365,172.71454902305402
144,114.99653521428331,174.01039435715006
145,114.57406467353282,175.27780597940156
146,114.15159413278232,176.54521760165304
147,114.0,177.85658641358444
148,113.89318938937889,179.16021591593164
149,113.1521270380065,180.27180944299025
150,112.41106468663409,181.38340297004885
151,111.81187238616263,182.5643828415121
152,111.38940184541214,183.83179446376357
153,110.95323380256251,185.09353239487498
154,110.35577023413006,186.28845953173987
155,110.0,187.54044272520872
156,110.0,188.8764118783033
157,109.93283922089671,190.20148233730987
158,109.51036868014621,191.46889395956137
159,109.0878981393957,192.73630558181287
160,108.25187336717536,193.74812663282464
161,107.56183513600955,194.8763297279809
162,106.9643715675771,196.0712568648458
163,106.36690799914466,197.26618400171068
164,105.83697259351626,198.48908221945118
165,105.41450205276578,199.75649384170268
166,104.99203151201527,201.02390546395418
167,104.56956097126476,202.29131708620568
168,104.14709043051428,203.55872870845718
169,103.61055371329613,204.77889257340775
170,103.01309014486368,205.97381971027264
171,102.41562657643124,207.16874684713753
172,102.0,208.40659987493882
173,102.0,209.74256902803336
174,101.97516404643488,211.07450786069532
175,101.55269350568439,212.34191948294685
176,101.13022296493389,213.60933110519832
177,100.7077524241834,214.87674272744982
178,100.28528188343289,216.14415434970132
179,99.75935517588326,217.3609672361751
180,99.01829282451085,218.47256076323373
181,98.27723047313845,219.58415429029233
182,98.0,220.83618481008364
183,98.0,222.1721539631782
184,97.83931736207956,223.48204791376133
185,97.41684682132906,224.74945953601284
186,96.98742498108726,226.01257501891274
187,96.04275213347806,226.95724786652193
188,95.42957525489199,228.14084949021603
189,94.73454526834384,229.26545473165618
190,94.0,230.2971652724257
191,94.0,231.63313442552027
192,94.0,232.96910357861483
193,93.83077609585786,234.25383585621321
194,93.08971374448546,235.3654293832718
195,92.34865139311304,236.47702291033045
196,91.49977221662199,237.50022778337802
197,90.5550993690128,238.4449006309872
198,89.82577744392546,239.52266766822362
199,89.40330690317498,240.7900792904751
200,88.98083636242448,242.05749091272654
201,88.55836582167397,243.32490253497807
202,88.13589528092349,244.59231415722954
203,87.35919823835715,245.64080176164285
204,86.41452539074793,246.5854746092521
205,86.0,247.7497417235508
206,86.0,249.08571087664535
207,85.8114189577495,250.377162084501
208,85.21395538931702,251.57208922136596
209,84.61649182088458,252.76701635823085
210,84.01902825245213,253.96194349509574
211,83.08541346121147,254.91458653878854
212,83.0,256.21517627784004
213,83.0,257.5511454309346
214,82.37271526194348,258.6272847380565
215,82.0,259.8088701747506
216,82.0,261.14483932784515
217,82.0,262.48080848093974
218,82.0,263.8167776340343
219,82.0,265.1527467871288
220,82.0,266.4887159402234
221,82.0,267.82468509331795
222,82.0,269.1606542464125
223,82.0,270.4966233995071
224,82.0,271.8325925526016
225,82.0,273.16856170569616
226,82.0,274.50453085879076
227,82.59432325799146,275.59432325799145
228,83.0,276.76225560260673
229,83.06945539083675,278.06945539083677
230,84.0,279.01998034642276
231,84.0,280.3559494995173
232,84.48926037129128,281.48926037129127
233,85.0,282.6136742433333
234,85.0,283.94964339642786
235,85.90906535174581,284.9090653517458
236,86.20736814024389,286.0
237,87.51545501539813,286.17181833846604
238,88.7828666376496,286.59428887921655
239,90.05299793935916,287.0
240,91.3889670924537,287.0
241,92.72493624554824,287.0
242,94.06090539864283,287.0
243,95.39687455173737,287.0
244,96.73284370483191,287.0
245,98.06675827803096,286.9833104304923
246,99.36283873233114,286.65929031691724
247,100.65891918663132,286.3352702033422
248,101.9549996409315,286.01125008976715
249,103.28958384468706,286.0
250,104.6255529977816,286.0
251,105.93281350339609,285.76679662415097
252,107.22889395769633,285.4427765105759
253,108.52497441199651,285.1187563970009
254,109.75697518416989,284.6215124079151
255,110.95190232103482,284.0240488394826
256,112.1468294578997,283.42658527105016
257,113.36248760850988,282.8791707971634
258,114.62989923076141,282.4567002564129
259,115.89731085301288,282.0342297156624
260,117.02152918719773,281.3189805418682
261,118.13312271425637,280.5779181904958
262,119.24471624131496,279.83685583912336
263,120.35630976837355,279.095793487751
264,121.46790329543218,278.3547311363785
265,122.62294036629875,277.68852981685063
266,123.81786750316363,277.0910662484182
267,125.0127946400285,276.49360267998577
268,126.16421848365015,275.83578151634987
269,127.10889133125934,274.8911086687406
270,128.05356417886856,273.94643582113144
271,128.9982370264778,273.0017629735222
272,129.942909874087,272.057090125913
273,130.8875827216962,271.1124172783038
274,131.83225556930543,270.16774443069454
275,132.77692841691464,269.22307158308536
276,133.72160126452385,268.2783987354762
277,134.6662741121331,267.33372588786693
278,135.61094695974228,266.3890530402577
279,136.5556198073515,265.4443801926485
280,137.50029265496073,264.49970734503927
281,138.37756574911353,263.49657900118194
282,139.17914724097025,262.4278036787063
283,139.980728732827,261.3590283562306
284,140.78231022468373,260.290253033755
285,141.30773795519553,259.0767861344134
286,141.73020849594604,257.8093745121619
287,142.34140070479265,256.65859929520735
288,143.28607355240186,255.71392644759814
289,144.23074640001107,254.76925359998893
290,145.06016830554728,253.75932677781086
291,145.38418841912232,252.46324632351067
292,145.70820853269737,251.1671658692105
293,146.05942668742142,249.88114662515716
294,146.65689025585388,248.68621948829227
295,147.4021687081595,247.5978312918405
296,148.34684155576872,246.65315844423128
297,149.13036920447468,245.608892386576
298,149.55283974522516,244.34148076432453
299,149.97531028597567,243.07406914207303
300,150.0,241.74210657800057
301,150.41992425394184,240.58007574605816
302,151.0,239.48438183418455
303,151.0,238.14841268109
304,151.08387780420443,236.83224439159113
305,151.6813413726369,235.63731725472618
306,152.0,234.3765731993061
307,152.95939595378843,234.0
308,152.79114532999716,232.79114532999716
309,151.84647248238792,232.15352751761208
310,150.95608346159,233.13174961523
311,150.53361292083952,234.39916123748148
312,150.111142380089,235.666572859733
313,150.0,236.98450608744116
314,150.0,238.3204752405357
315,150.0,239.6564443936303
316,149.75930436015057,240.96278255939774
317,149.43528424657552,242.25886301369792
318,149.11126413300047,243.55494346799813
319,149.0,244.87721538039085
320,149.0,246.2131845334854
321,149.0,247.54915368657998
322,149.0,248.88512283967452
323,148.76052415772995,250.19737921135027
324,148.49851905076122,251.50740474619397
325,148.23651394379246,252.81743028103764
326,148.0,254.12997993845994
327,148.0,255.46594909155448
328,148.0,256.8019182446491
329,148.0,258.1378873977436
330,148.0,259.47385655083815
331,148.0,260.80982570393275
332,148.0,262.1457948570273
333,148.0,263.4817640101218
334,148.0,264.8177331632164
335,148.0,266.15370231631096
336,148.0,267.4896714694055
337,148.0,268.8256406225001
338,148.0,270.1616097755946
339,148.0,271.49757892868917
340,148.0,272.83354808178376
341,147.173026432503,273.82697356749696
342,147.0,275.09127282559973
343,147.3554868141261,276.2369912094174
344,148.4670803411847,276.9780535607898
345,149.57867386824327,277.7191159121622
346,150.77026255669543,278.30810502267815
347,152.0106787750855,278.8042715100342
348,153.25109499347548,279.3004379973902
349,154.4915112118655,279.7966044847462
350,155.77300152083774,279.84539969583244
351,157.08302705568138,279.5833945888637
352,158.39305259052506,279.321389481895
353,159.7030781253688,279.05938437492625
354,161.00231928100396,278.749420179749
355,162.29839973530414,278.42540006617395
356,163.59448018960438,278.1013799525989
357,164.78715183795345,277.5277088972279
358,165.9327359357022,276.8403584385787
359,167.07832003345098,276.1530079799294
360,168.22390413119973,275.46565752128015
361,169.36948822894846,274.7783070626309
362,170.51507232669724,274.0909566039816
363,171.660656424446,273.4036061453324
364,172.80624052219474,272.71625568668316
365,173.95182461994347,272.0289052280339
366,175.09740871769225,271.34155476938463
367,176.242992815441,270.6542043107354
368,177.38857691318975,269.96685385208616
369,178.53416101093853,269.27950339343687
370,179.61900423645395,268.5047966108368
371,180.66222087848348,267.6702232972132
372,181.70543752051307,266.8356499835895
373,182.74865416254264,266.00107666996587
374,183.79187080457217,265.1665033563423
375,184.85554698715387,264.3583397596346
376,185.9243223096295,263.55675826777787
377,186.99309763210513,262.75517677592114
378,188.0464047159356,261.9381270454192
379,188.84798620779233,260.8693517229436
380,189.64956769964905,259.80057640046795
381,190.4511491915058,258.73180107799226
382,191.29784596669927,257.70215403330076
383,192.24251881430845,256.7574811856915
384,193.1871916619177,255.8128083380823
385,194.1318645095269,254.8681354904731
386,195.06494410109403,253.91340786520794
387,195.86652559295075,252.8446325427323
388,196.66810708480747,251.77585722025668
389,197.46968857666428,250.70708189778097
390,198.2507892670644,249.62381609940343
391,198.99185161843678,248.51222257234485
392,199.73291396980918,247.40062904528625
393,200.47397632118157,246.28903551822768
394,201.21503867255396,245.17744199116908
395,201.95610102392635,244.0658484641105
396,202.6466332622048,242.92227789632534
397,203.33398372085404,241.7766937985766
398,204.0213341795033,240.63110970082784
399,204.70868463815256,239.48552560307908
400,205.15096115321555,238.24519423392226
401,205.41296626018428,236.9351686990786
402,205.67497136715303,235.6251431642348
403,205.93697647412176,234.31511762939115
404,206.60876657889563,233.18831122813918
405,207.41034807075235,232.11953590566355
406,208.21192956260907,231.05076058318792
407,209.00546152006626,229.97815391973492
408,209.32948163364134,228.68207346543466
409,209.65350174721638,227.38599301113447
410,209.97752186079143,226.0899125568343
411,210.0,224.75671058912974
412,210.0,223.4207414360352
413,210.0,222.08477228294066
414,211.04105872408613,221.30596085060927
415,212.15265225114481,220.5648984992368
416,213.14202783818502,219.71594432362994
417,213.73949140661747,218.52101718676508
418,214.0,217.24654577043168
419,214.0,215.91057661733714
420,214.0,214.5746074642426
421,213.23863831114795,214.0
422,211.93117670164096,214.06882329835904
423,210.98650385403178,215.01349614596822
424,210.0418310064226,215.9581689935774
425,210.0,217.276811176484
426,210.0,218.61278032957853
427,209.4307503103961,219.75899958613854
428,208.62916881853937,220.82777490861417
429,207.82758732668265,221.8965502310898
430,207.02600583482592,222.96532555356544
431,206.68649212209846,224.2540315116062
432,206.3624720085234,225.55011196590638
433,206.03845189494834,226.84619242020668
434,205.56271424519542,228.09321438701141
435,205.06654775783943,229.33363060540142
436,204.57038127048344,230.5740468237914
437,204.07421478312745,231.81446304218142
438,203.64072107004654,233.07783678986038
439,203.21825052929606,234.34524841211186
440,202.79577998854552,235.61266003436344
441,202.37330944779504,236.88007165661492
442,201.9572915715925,238.14947949942623
443,201.59027261901826,239.43404583343604
444,201.22325366644404,240.71861216744588
445,200.8562347138698,242.0031785014557
446,200.48921576129553,243.28774483546565
447,200.1221968087213,244.57231116947546
448,199.6690292359823,245.8274269100443
449,199.17286274862627,247.0678431284343
450,198.67669626127028,248.3082593468243
451,198.1805297739143,249.5486755652143
452,198.0,250.84987786053307
453,198.0,252.1858470136276
454,198.0,253.52181616672215
455,198.0,254.85778531981668
456,198.0,256.1937544729112
457,198.0,257.52972362600576
458,197.67848977325508,258.8037755668623
459,197.18232328589903,260.0441917852524
460,196.68615679854304,261.2846080036424
461,196.18999031118705,262.5250242220324
462,196.0,263.82440458434405
463,196.0,265.1603737374386
464,196.0,266.4963428905331
465,196.0,267.8323120436278
466,195.7708812069442,269.145593965279
467,195.50887609997548,270.4556195001226
468,195.24687099300675,271.7656450349663
469,195.0,273.07716914241314
470,195.0,274.4131382955077
471,195.0,275.74910744860233
472,195.0,277.08507660169687
473,195.3765947717405,278.18829738587027
474,196.5715219086054,278.7857609543027
475,197.7664490454703,279.38322452273513
476,198.96137618233521,279.9806880911676
477,200.25418704205654,280.31354676051416
478,201.55026749635684,280.6375668740892
479,202.846347950657,280.96158698766425
480,204.0532669468777,280.47336652656116
481,205.2481940837426,279.8759029581287
482,206.44312122060748,279.27843938969625
483,207.61170093921612,278.63297943647035
484,208.75728503696496,277.945628977821
485,209.9028691347137,277.25827851917177
486,211.04845323246246,276.57092806052253
487,212.17669848285178,275.85864121371856
488,213.2199151248813,275.02406790009496
489,214.26313176691087,274.1894945864713
490,215.3063484089405,273.3549212728476
491,216.34956505097006,272.52034795922395
492,217.3927816929996,271.6857746456003
493,218.43599833502913,270.8512013319767
494,219.4792149770587,270.01662801835306
495,220.52243161908822,269.1820547047294
496,221.56564826111776,268.34748139110576
497,222.55135061950944,267.44864938049056
498,223.49602346711865,266.5039765328814
499,224.44069631472783,265.5593036852722
500,225.385369162337,264.614630837663
501,226.29157634261736,263.6355295717283
502,227.12614965624098,262.5923129296988
503,227.9607229698647,261.5490962876691
504,228.79529628348834,260.5058796456396
505,229.62986959711196,259.46266300361003
506,230.52571367892355,258.4742863210764
507,231.47038652653274,257.52961347346724
508,232.41505937414195,256.58494062585805
509,233.35973222175122,255.64026777824878
510,234.2689273308351,254.6638408364561
511,235.10350064445873,253.62062419442657
512,235.93807395808238,252.57740755239703
513,236.772647271706,251.53419091036747
514,237.60722058532966,250.49097426833794
515,238.31627629960303,249.36744740079396
516,238.91373986803552,248.17252026392896
517,239.51120343646798,246.97759312706407
518,240.09024303566224,245.7743924108444
519,240.58640952301823,244.53397619245442
520,241.08257601037423,243.2935599740644
521,241.57874249773022,242.05314375567443
522,242.03955635285857,240.8022182357072
523,242.3015614598273,239.4921927008635
524,242.56356656679603,238.18216716601984
525,242.82557167376476,236.8721416311762
526,243.14121331580793,235.57636005257618
527,243.56368385655844,234.3089484303247
528,243.98615439730898,233.0415368080731
529,244.71677555762778,231.92483666355832
530,245.45783790900018,230.81324313649975
531,246.0,229.6414274562618
532,246.0,228.30545830316726
533,246.0,226.96948915007272
534,246.0,225.63351999697818
535,246.0,224.29755084388353
536,246.0,222.961581690789
537,245.73526808661254,222.26473191338746
538,244.79059523900332,223.20940476099668
539,243.84592239139414,224.15407760860586
540,242.90124954378496,225.09875045621504
541,242.0,226.0614098251914
542,242.0,227.39737897828593
543,242.0,228.73334813138047
544,241.4068494924747,229.88972576128796
545,240.6657871411023,231.00131928834656
546,239.9247247897299,232.11291281540514
547,239.18366243835746,233.22450634246383
548,238.44260008698507,234.33609986952243
549,238.0,235.53806049901982
550,238.0,236.87402965211436
551,238.0,238.2099988052089
552,237.75583570633935,239.4883285873213
553,237.1583721379069,240.6832557241862
554,236.5609085694744,241.8781828610512
555,235.9741517123505,243.0775448629485
556,235.5516811716,244.3449564852
557,235.1292106308495,245.6123681074515
558,234.7750799164734,246.89968033410636
559,234.45105980289836,248.19576078840655
560,234.12703968932328,249.49184124270684
561,233.84072014370528,250.79639928147353
562,233.57871503673655,252.1064248163172
563,233.31670992976782,253.41645035116088
564,233.0547048227991,254.72647588600452
565,232.79269971583037,256.0365014208482
566,232.5306946088616,257.34652695569196
567,232.26868950189288,258.65655249053566
568,232.00668439492415,259.9665780253793
569,231.7446792879554,261.27660356022295
570,231.48267418098666,262.58662909506666
571,231.22066907401793,263.8966546299103
572,231.0,265.2107732386306
573,231.0,266.5467423917253
574,231.0,267.8827115448198
575,231.676002422269,269.0140036334035
576,232.41706477364139,270.12559716046206
577,233.15812712501378,271.23719068752064
578,233.89918947638617,272.34878421457927
579,234.64025182775862,273.46037774163796
580,235.68742391245917,274.0
581,237.0233930655537,274.0
582,238.33365944359971,273.8665362225601
583,239.5740756619897,273.3703697352041
584,240.8144918803797,272.87420324784813
585,242.0549080987698,272.3780367604921
586,243.28449405571976,271.85775297214013
587,244.47942119258465,271.26028940370765
588,245.67434832944954,270.6628258352752
589,246.86927546631443,270.0653622668428
590,247.9290891736216,269.2567286611027
591,248.97230581565117,268.4221553474791
592,250.0155224576808,267.58758203385537
593,251.05873909971035,266.7530087202317
594,252.11196032703634,265.9328238037782
595,253.2575444247851,265.2454733451289
596,254.40312852253385,264.5581228864797
597,255.5487126202826,263.87077242783045
598,256.69429671803147,263.18342196918115
599,257.6925834632783,262.3074165367217
600,258.63725631088755,261.36274368911245
601,259.58192915849673,260.41807084150327
602,260.5266020061059,259.4733979938941
603,261.5204360129646,258.5836511896283
604,262.5636526549942,257.7490778760046
605,263.60686929702376,256.914504562381
606,264.6500859390533,256.07993124875736
607,265.69330258108283,255.2453579351337
608,266.58921537848994,254.2634807768876
609,267.42378869211353,253.22026413485804
610,268.25836200573724,252.17704749282842
611,269.0929353193609,251.1338308507989
612,269.92750863298454,250.09061420876932
613,270.78097781532676,249.0628266216079
614,271.63624442557085,248.036506689315
615,272.49151103581494,247.0101867570221
616,273.346777646059,245.9838668247292
617,274.20204425630317,244.9575468924362
618,275.05731086654725,243.93122696014328
619,275.91257747679134,242.90490702785038
620,276.7678440870354,241.8785870955575
621,277.6231106972795,240.85226716326457
622,278.4783773075236,239.82594723097168
623,279.33364391776774,238.79962729867867
624,280.19204051527896,237.77595273217452
625,281.0614777153162,236.76160933213112
626,281.9309149153534,235.7472659320877
627,282.8003521153906,234.7329225320443
628,283.6697893154278,233.71857913200088
629,284.5392265154651,232.7042357319574
630,285.4086637155023,231.689892331914
631,286.1911065748917,230.61778685021656
632,286.78857014332414,229.4228597133517
633,287.3860337117566,228.2279325764868
634,287.98349728018906,227.03300543962192
635,288.5809608486215,225.83807830275705
636,289.178424417054,224.64315116589208
637,289.7758879854864,223.4482240290272
638,290.4630856089879,222.3053715865181
639,291.20414796036033,221.19377805945953
640,291.9452103117327,220.08218453240093
641,292.6862726631051,218.97059100534236
642,293.42733501447753,217.85899747828367
643,294.16839736584996,216.74740395122507
644,294.9094597172223,215.6358104241665
645,295.65052206859474,214.5242168971079
646,296.4594189153502,213.46401126542472
647,297.32885611538745,212.4496678653813
648,298.19829331542473,211.4353244653378
649,299.06773051546196,210.4209810652944
650,299.93716771549913,209.406637665251
651,300.80660491553635,208.39229426520757
652,301.6760421155736,207.37795086516417
653,302.51459180214295,206.3383819686734
654,303.3347975236308,205.28383175533185
655,304.15500324511873,204.22928154199022
656,304.9752089666066,203.17473132864868
657,305.79541468809447,202.12018111530713
658,306.61562040958233,201.0656309019656
659,307.4358261310702,200.01108068862405
660,308.25603185255807,198.9565304752825
661,309.0688812506489,197.8966781240267
662,309.8099436020213,196.7850845969681
663,310.55100595339366,195.6734910699095
664,311.2920683047661,194.56189754285091
665,312.03313065613844,193.4503040157923
666,312.77419300751086,192.33871048873374
667,313.5152553588833,191.22711696167505
668,314.2563177102557,190.11552343461648
669,314.99738006162806,189.00392990755788
670,315.7634194475111,187.90940078926985
671,316.5295474500418,186.81493221422602
672,317.2956754525725,185.72046363918219
673,318.0618034551032,184.62599506413835
674,318.8279314576339,183.5315264890944
675,319.5940594601646,182.43705791405057
676,320.3601874626953,181.34258933900674
677,321.12631546522596,180.2481207639629
678,321.89244346775666,179.15365218891907
679,322.70505723084665,178.09349784605433
680,323.5252629523346,177.03894763271268
681,324.34546867382244,175.98439741937113
682,325.1656743953103,174.9298472060296
683,325.98588011679817,173.87529699268805
684,326.80608583828604,172.8207467793465
685,327.6262915597739,171.76619656600496
686,328.4464972812618,170.71164635266334
687,329.2667030027497,169.6570961393218
688,330.08690872423756,168.60254592598025
689,330.9071144457254,167.5479957126387
690,331.7273201672133,166.49344549929717
691,332.54752588870116,165.43889528595562
692,333.367731610189,164.38434507261408
693,334.187937331677,163.32979485927245
694,335.0081430531649,162.2752446459309
695,335.82834877465274,161.22069443258937
696,336.5058497442633,160.07260880218394
697,337.1455814197462,158.89976739713205
698,337.785313095229,157.7269259920802
699,338.4250447707119,156.55408458702823
700,339.06477644619474,155.38124318197634
701,339.7045081216776,154.20840177692446
702,340.3442397971604,153.0355603718726
703,340.98397147264325,151.86271896682072
704,341.6237031481261,150.68987756176887
705,342.3377521511658,149.56574723421542
706,343.15795787265364,148.51119702087388
707,343.9781635941415,147.45664680753234
708,344.7983693156294,146.4020965941908
709,345.61857503711724,145.34754638084925
710,346.4387807586051,144.2929961675077
711,347.258986480093,143.23844595416617
712,348.0791922015809,142.18389574082454
713,348.8993979230688,141.129345527483
714,349.5241818608067,139.9516362783866
715,350.12164542923915,138.7567091415217
716,350.7191089976716,137.56178200465683
717,351.316572566104,136.36685486779194
718,351.9140361345365,135.17192773092694
719,352.511499702969,133.97700059406205
720,353.1089632714014,132.78207345719716
721,353.70642683983385,131.5871463203323
722,354.2759790522997,130.3790471323256
723,354.81856751483224,129.1582230916274
724,355.36115597736483,127.9373990509291
725,355.90374443989737,126.7165750102309
726,356.4463329024299,125.49575096953268
727,356.98892136496244,124.27492692883447
728,357.531509827495,123.05410288813627
729,358.0905185054387,121.84159261548231
730,358.75334482273246,120.68164656021816
731,359.41617114002634,119.5217005049539
732,360.07899745732016,118.36175444968974
733,360.741823774614,117.20180839442558
734,361.40465009190774,116.04186233916143
735,362.06997299232484,114.88337834612527
736,362.75732345097407,113.73779424837652
737,363.4446739096234,112.59221015062768
738,364.13202436827265,111.44662605287893
739,364.8193748269219,110.30104195513017
740,365.2705719930975,109.05299802415878
741,365.6375909456717,107.76843169014896
742,366.004609898246,106.48386535613913
743,366.37162885082023,105.1992990221292
744,366.7386478033945,103.91473268811937
745,367.1428490348293,102.64287741292672
746,367.63901552218533,101.40246119453673
747,368.1351820095413,100.16204497614673
748,368.6313484968973,98.92162875775674
749,369.15354837430993,97.69290325138012
750,369.7510119427424,96.49797611451513
751,370.3484755111749,95.30304897765023
752,370.94593907960734,94.10812184078534
753,371.29470146304783,92.82119414780861
754,371.6187215766229,91.52511369350844
755,371.9427416901979,90.22903323920826
756,372.49188446187856,89.01623107624286
757,372.85872835988374,87.85872835988374
758,371.91405551227456,86.91405551227454
759,370.96397267915563,85.97598178610376
760,369.85237915209706,85.23491943473137
761,368.7407856250385,84.49385708335898
762,367.57721394268395,84.14092868577201
763,366.3098023204325,84.5633992265225
764,365.042390698181,84.985869767273
765,363.8450391966591,85.57748040167044
766,362.6501120597942,86.17494397010289
767,361.4551849229292,86.77240753853539
768,360.31184703122545,87.45876864584972
769,359.2002535041668,88.19983099722211
770,358.08865997710825,88.9408933485945
771,357.01646950246976,89.73764787314767
772,355.94769417999413,90.53922936500439
773,354.8789188575185,91.34081085686111
774,353.8321890077209,92.1678109922791
775,352.8875161601117,93.1124838398883
776,351.94284331250253,94.05715668749748
777,350.99793011731145,95.00155241201642
778,349.92915479483565,95.80313390387327
779,348.86037947236,96.60471539573
780,347.7916041498844,97.40629688758672
781,346.8450566041707,98.30988679165868
782,346.24759303573825,99.50481392852355
783,345.6501294673058,100.69974106538841
784,345.0526658988734,101.89466820225329
785,344.26907722612947,102.97456369849405
786,343.46749573427275,104.04333902096968
787,342.665914242416,105.11211434344531
788,341.87457558352315,106.18813662471526
789,341.1335132321508,107.29973015177384
790,340.39245088077837,108.41132367883243
791,339.71894044700565,109.56211910598866
792,339.1214768785732,110.75704624285352
793,338.5240133101408,111.95197337971838
794,337.9480628242821,113.15581152715373
795,337.5255922835316,114.42322314940517
796,337.1031217427811,115.69063477165663
797,336.755070652727,116.97971738909199
798,336.43105053915195,118.27579784339217
799,336.1070304255769,119.57187829769234
800,335.78301031200186,120.86795875199252
801,335.4589901984268,122.1640392062927
802,335.1349700848518,123.46011966059288
803,335.0,124.7794732369523
804,335.0,126.11544239004684
805,335.0,127.45141154314138
806,335.0,128.7873806962359
807,335.0,130.12334984933045
808,335.0,131.459319002425
809,335.0,132.79528815551953
810,335.0,134.13125730861407
811,335.14774998021005,135.44324994063018
812,335.57022052096056,136.71066156288163
813,335.992691061711,137.97807318513307
814,336.5871271687776,139.17425433755523
815,337.18459073721004,140.3691814744201
816,337.7820543056426,141.56410861128515
817,338.600070447411,142.600070447411
818,339.5447432950202,143.5447432950202
819,340.4894161426294,144.48941614262938
820,341.4340889902386,145.4340889902386
821,342.23955001967005,146.47910003934012
822,342.8370135881025,147.674027176205
823,343.4344771565349,148.86895431306985
824,344.0505027205069,150.05050272050693
825,344.9951755681161,150.9951755681161
826,345.9398484157253,151.9398484157253
827,346.8845212633345,152.8845212633345
828,347.82919411094366,153.8291941109437
829,348.6836744736953,154.85459309211913
830,349.51824778731896,155.89780973414867
831,350.35282110094255,156.9410263761782
832,351.1873944145662,157.98424301820776
833,352.02196772818985,159.0274596602373
834,352.8565410418135,160.07067630226686
835,353.6911143554371,161.1138929442964
836,354.52568766906074,162.15710958632593
837,355.3602609826844,163.2003262283555
838,356.22053744889837,164.2205374488984
839,357.1652102965076,165.16521029650758
840,358.1098831441168,166.10988314411676
841,359.05455599172615,167.05455599172612
842,359.99922883933533,167.9992288393353
843,360.9439016869445,168.9439016869445
844,361.9812664188201,169.7850131350561
845,363.02448306084966,170.61958644867974
846,364.0676997028792,171.45415976230336
847,365.11091634490873,172.288733075927
848,366.12330638955063,173.1541329869383
849,366.9578797031743,174.19734962896783
850,367.79245301679794,175.2405662709974
851,368.62702633042153,176.28378291302693
852,369.4615996440452,177.3269995550565
853,370.29617295766883,178.37021619708602
854,371.1307462712926,179.41343283911576
855,371.96531958491624,180.4566494811453
856,372.7998928985399,181.49986612317483
857,373.6344662121635,182.5430827652044
858,374.46903952578714,183.58629940723392
859,375.3036128394108,184.6295160492635
860,376.13818615303444,185.67273269129302
861,376.97275946665803,186.71594933332256
862,377.8073327802817,187.75916597535212
863,378.72658836285376,188.72658836285376
864,379.67126121046294,189.67126121046294
865,380.6159340580721,190.61593405807213
866,381.5606069056815,191.56060690568148
867,382.4463905140049,192.55798814250613
868,383.2809638276285,193.60120478453567
869,384.11553714125216,194.6444214265652
870,384.9501104548758,195.68763806859477
871,385.78468376849946,196.7308547106243
872,386.70095142226796,197.70095142226796
873,387.64562426987715,198.64562426987715
874,388.59029711748633,199.59029711748633
875,389.5349699650955,200.5349699650955
876,390.25192074713226,201.6298018678306
877,390.74808723448825,202.8702180862206
878,391.24425372184425,204.11063430461058
879,391.7404202092003,205.3510505230008
880,392.32774880716926,206.5462480119488
881,393.0150992658185,207.69183210969751
882,393.7024497244677,208.83741620744624
883,394.38980018311696,209.98300030519496
884,395.0771506417662,211.1285844029437
885,395.76450110041543,212.27416850069244
886,396.4518515590647,213.41975259844116
887,397.13920201771396,214.5653366961899
888,397.8265524763632,215.7109207939386
889,398.24225616681264,216.96902466725052
890,398.5662762803877,218.2651051215507
891,398.8902963939627,219.56118557585089
892,399.45463396740064,220.75772327900106
893,400.1419844260499,221.90330737674978
894,400.8293348846991,223.0488914744985
895,401.51668534334834,224.19447557224723
896,402.0961833994649,225.38473359785954
897,402.42020351303995,226.68081405215972
898,402.744223626615,227.9768945064599
899,403.0551824028797,229.2759120143986
900,403.31718750984845,230.5859375492423
901,403.5791926168172,231.89596308408596
902,403.8411977237859,233.2059886189296
903,404.1664095643796,234.49922869313886
904,404.58888010513016,235.76664031539056
905,405.01135064588067,237.03405193764206
906,405.4338211866312,238.30146355989353
907,405.8562917273817,239.56887518214504
908,406.0,240.88152369301224
909,406.0,242.21749284610678
910,406.0,243.55346199920132
911,406.0,244.88943115229586
912,406.0370555819445,246.222333491667
913,406.25668755778446,247.54012534670665
914,406.4763195336244,248.85791720174626
915,406.6959515094643,250.1757090567859
916,406.91558348530424,251.49350091182555
917,407.0,252.82248354056514
918,407.0,254.15845269365968
919,407.0,255.49442184675422
920,407.0,256.83039099984876
921,407.16494823469037,258.15463764283277
922,407.3538828042122,259.47717962948565
923,407.54281737373407,260.7997216161385
924,407.7317519432559,262.12226360279135
925,407.92068651277776,263.44480558944423
926,408.1274319197387,264.76459151843216
927,408.34706389557863,266.08238337347177
928,408.5666958714186,267.4001752285114
929,408.7863278472585,268.71796708355106
930,409.0,270.03625218863067
931,409.0,271.3722213417252
932,409.0,272.70819049481975
933,409.0,274.0441596479143
934,409.0,275.3801288010088
935,409.0,276.71609795410336
936,409.0,278.0520671071979
937,409.0,279.38803626029244
938,409.0,280.724005413387
939,409.0,282.0599745664815
940,409.0,283.39594371957605
941,409.0,284.7319128726706
942,409.0,286.06788202576536
943,409.0,287.4038511788599
944,409.0,288.73982033195443
945,409.0,290.075789485049
946,408.86979048572175,291.39062854283475
947,408.44731994497124,292.6580401650862
948,408.0248494042208,293.92545178733764
949,407.6023788634703,295.1928634095891
950,407.1799083227198,296.4602750318406
951,406.7574377819693,297.727686654092
952,406.33496724121886,298.99509827634347
953,406.0,300.2767097292999
954,406.0,301.61267888239445
955,406.0,302.9486480354892
956,406.0,304.28461718858375
957,406.0,305.6205863416783
958,405.5722153778874,306.85556924422525
959,404.9600791055398,308.0399208944602
960,404.01540625793064,308.98459374206936
961,403.07073341032145,309.92926658967855
962,402.12606056271227,310.87393943728773
963,400.96452826365237,311.5177358681738
964,399.817853697578,312.182146302422
965,398.87318084996883,313.12681915003117
966,397.91587559437676,314.0560829370822
967,396.8042820673182,314.79714528845454
968,395.6926885402594,315.5382076398271
969,394.64399921632827,316.35600078367173
970,393.6993263687191,317.3006736312809
971,392.68965852432194,318.15517073783906
972,391.49473138745697,318.7526343062715
973,390.649902125296,319.70019574940795
974,390.0524385568636,320.8951228862729
975,388.8438273552101,321.3853908815966
976,387.5764157329587,321.8078614223471
977,386.2716263786738,322.0
978,384.9389590845568,322.0203469718144
979,383.67154746230534,322.4428175125649
980,382.4041358400537,322.86528805331545
981,381.1860957871651,323.40695210641746
982,379.99116865030015,324.00441567484995
983,378.79624151343523,324.6018792432824
984,377.55425592217966,325.0
985,376.2182867690851,325.0
986,374.8823176159906,325.0
987,373.6792199218181,325.3207800781819
988,372.6245928721746,326.0
989,371.2886237190801,326.0
990,369.95265456598554,326.0
991,368.616685412891,326.0
992,367.28071625979646,326.0
993,366.25382352328205,325.25382352328205
994,365.02299151598027,325.0
995,364.07158460925024,324.07158460925024
996,363.12691176164105,323.12691176164105
997,362.1822389140318,322.1822389140318
998,361.23756606642263,321.23756606642263
999,361.0,320.0



"""

# --- Main Execution ---
if __name__ == "__main__":
    # 1. Parse the coordinates from the data string
    coordinates = parse_coordinates(data_text)
    
    if not coordinates:
        print("No valid coordinates were parsed. Please check the data_text format.")
    else:
        # 2. Process the coordinates (apply FFT filter)
        x_filtered, y_filtered = process_coordinates(coordinates)
        
        # 3. Scale the filtered coordinates for the 12-bit DAC
        x_dac, y_dac = scale_for_dac(x_filtered, y_filtered)
        
        # 4. Generate the C header file
        generate_stm32_header(x_dac, y_dac, filename="drawing_coordinates_data.h")
        
        # --- Output Summary ---
        print("Processing complete!")
        print("Generated 'drawing_coordinates_data.h' for STM32.")
        print(f"Original points parsed: {len(coordinates)}")
        print(f"Filtered points generated: {len(x_filtered)}")
        print(f"DAC range: X=[{min(x_dac)}, {max(x_dac)}], Y=[{min(y_dac)}, {max(y_dac)}]")
