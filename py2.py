import numpy as np
import re

# Parse the coordinate data from the provided text
def parse_coordinates(data_text):
    coordinates = []
    lines = data_text.strip().split('\n')
    for line in lines:
        # Split using pipe symbol and extract numeric values
        parts = re.split(r'\s*\|\s*', line.strip())
        if len(parts) >= 3:
            try:
                x = float(parts[1])
                y = float(parts[2])
                coordinates.append((x, y))
            except (ValueError, IndexError):
                continue
    return coordinates

# Process coordinates with FFT filtering
def process_coordinates(coordinates, cutoff_freq=0.08):
    # Convert to complex signal (x + j*y)
    x = np.array([p[0] for p in coordinates])
    y = np.array([p[1] for p in coordinates])
    z = x + 1j * y
    
    # Apply FFT
    Z = np.fft.fft(z)
    freqs = np.fft.fftfreq(len(z))
    
    # Create low-pass filter mask
    mask = np.abs(freqs) <= cutoff_freq
    Z_filtered = Z * mask
    
    # Inverse FFT to get filtered signal
    z_filtered = np.fft.ifft(Z_filtered)
    x_filtered = np.real(z_filtered)
    y_filtered = np.imag(z_filtered)
    
    return x_filtered, y_filtered

# Scale coordinates for 12-bit DAC (0-4095)
def scale_for_dac(x, y):
    # Find min/max values for scaling
    x_min, x_max = np.min(x), np.max(x)
    y_min, y_max = np.min(y), np.max(y)
    
    # Scale to 12-bit range
    x_dac = np.round((x - x_min) / (x_max - x_min) * 3430).astype(np.uint16)
    y_dac = np.round((y - y_min) / (y_max - y_min) * 3430).astype(np.uint16)
    return x_dac, y_dac

# Generate C header file for STM32
def generate_stm32_header(x_dac, y_dac, filename="arrow_data.h"):
    with open(filename, 'w') as f:
        f.write("#ifndef ARROW_DATA_H\n")
        f.write("#define ARROW_DATA_H\n\n")
        f.write("#include <stdint.h>\n\n")
        f.write(f"#define ARROW_POINTS {len(x_dac)}\n\n")
        
        # X coordinates array
        f.write("const uint16_t arrow_x[ARROW_POINTS] = {\n    ")
        f.write(",\n    ".join(map(str, x_dac)))
        f.write("\n};\n\n")
        
        # Y coordinates array
        f.write("const uint16_t arrow_y[ARROW_POINTS] = {\n    ")
        f.write(",\n    ".join(map(str, y_dac)))
        f.write("\n};\n\n#endif\n")

# Main processing - Updated with new.csv data
data_text = """
{new.csvï¼š0 | 10 | 121
1 | 11.756 | 120.986
2 | 13.511 | 120.973
3 | 15.267 | 120.959
4 | 17.022 | 120.946
5 | 18.778 | 120.932
6 | 20.533 | 120.919
7 | 22.289 | 120.905
8 | 24.045 | 120.892
9 | 25.8 | 120.878
10 | 27.556 | 120.865
11 | 29.311 | 120.851
12 | 31.067 | 120.838
13 | 32.822 | 120.824
14 | 34.578 | 120.81
15 | 36.333 | 120.797
16 | 38.089 | 120.783
17 | 39.845 | 120.77
18 | 41.6 | 120.756
19 | 43.356 | 120.743
20 | 45.111 | 120.729
21 | 46.867 | 120.716
22 | 48.622 | 120.702
23 | 50.378 | 120.689
24 | 52.134 | 120.675
25 | 53.889 | 120.662
26 | 55.645 | 120.648
27 | 57.4 | 120.634
28 | 59.156 | 120.621
29 | 60.911 | 120.607
30 | 62.667 | 120.594
31 | 64.422 | 120.58
32 | 66.178 | 120.567
33 | 67.934 | 120.553
34 | 69.689 | 120.54
35 | 71.445 | 120.526
36 | 73.2 | 120.513
37 | 74.956 | 120.499
38 | 76.711 | 120.486
39 | 78.467 | 120.472
40 | 80.223 | 120.458
41 | 81.978 | 120.445
42 | 83.734 | 120.431
43 | 85.489 | 120.418
44 | 87.245 | 120.404
45 | 89 | 120.391
46 | 90.756 | 120.377
47 | 92.511 | 120.364
48 | 94.267 | 120.35
49 | 96.023 | 120.337
50 | 97.778 | 120.323
51 | 99.534 | 120.31
52 | 101.289 | 120.296
53 | 103.045 | 120.282
54 | 104.8 | 120.269
55 | 106.556 | 120.255
56 | 108.312 | 120.242
57 | 110.067 | 120.228
58 | 111.823 | 120.215
59 | 113.578 | 120.201
60 | 115.334 | 120.188
61 | 117.089 | 120.174
62 | 118.845 | 120.161
63 | 120.6 | 120.147
64 | 122.356 | 120.134
65 | 124.112 | 120.12
66 | 125.867 | 120.106
67 | 127.623 | 120.093
68 | 129.378 | 120.079
69 | 131.134 | 120.066
70 | 132.889 | 120.052
71 | 134.645 | 120.039
72 | 136.401 | 120.025
73 | 138.156 | 120.012
74 | 139.912 | 119.998
75 | 141.667 | 119.985
76 | 143.423 | 119.971
77 | 145.178 | 119.957
78 | 146.934 | 119.944
79 | 148.69 | 119.93
80 | 150.445 | 119.917
81 | 152.201 | 119.903
82 | 153.956 | 119.89
83 | 155.712 | 119.876
84 | 157.467 | 119.863
85 | 159.223 | 119.849
86 | 160.978 | 119.836
87 | 162.734 | 119.822
88 | 164.49 | 119.809
89 | 166.245 | 119.795
90 | 168.001 | 119.781
91 | 169.756 | 119.768
92 | 171.512 | 119.754
93 | 173.267 | 119.741
94 | 175.023 | 119.727
95 | 176.779 | 119.714
96 | 178.534 | 119.7
97 | 180.29 | 119.687
98 | 182.045 | 119.673
99 | 183.801 | 119.66
100 | 185.556 | 119.646
101 | 187.312 | 119.633
102 | 189.067 | 119.619
103 | 190.823 | 119.605
104 | 192.579 | 119.592
105 | 194.334 | 119.578
106 | 196.09 | 119.565
107 | 197.845 | 119.551
108 | 199.601 | 119.538
109 | 201.356 | 119.524
110 | 203.112 | 119.511
111 | 204.868 | 119.497
112 | 206.623 | 119.484
113 | 208.379 | 119.47
114 | 210.134 | 119.457
115 | 211.89 | 119.443
116 | 213.645 | 119.429
117 | 215.401 | 119.416
118 | 217.156 | 119.402
119 | 218.912 | 119.389
120 | 220.668 | 119.375
121 | 222.423 | 119.362
122 | 224.179 | 119.348
123 | 225.934 | 119.335
124 | 227.69 | 119.321
125 | 229.445 | 119.308
126 | 231.201 | 119.294
127 | 232.957 | 119.281
128 | 234.712 | 119.267
129 | 236.468 | 119.253
130 | 238.223 | 119.24
131 | 239.979 | 119.226
132 | 241.734 | 119.213
133 | 243.49 | 119.199
134 | 245.245 | 119.186
135 | 247.001 | 119.172
136 | 248.757 | 119.159
137 | 250.512 | 119.145
138 | 252.268 | 119.132
139 | 254.023 | 119.118
140 | 255.779 | 119.105
141 | 257.534 | 119.091
142 | 259.29 | 119.077
143 | 261.046 | 119.064
144 | 262.801 | 119.05
145 | 264.557 | 119.037
146 | 266.312 | 119.023
147 | 268.068 | 119.01
148 | 269.823 | 118.996
149 | 271.579 | 118.983
150 | 273.335 | 118.969
151 | 275.09 | 118.956
152 | 276.846 | 118.942
153 | 278.601 | 118.929
154 | 280.357 | 118.915
155 | 282.112 | 118.901
156 | 283.868 | 118.888
157 | 285.623 | 118.874
158 | 287.379 | 118.861
159 | 289.135 | 118.847
160 | 290.89 | 118.834
161 | 292.646 | 118.82
162 | 294.401 | 118.807
163 | 296.157 | 118.793
164 | 297.912 | 118.78
165 | 299.668 | 118.766
166 | 301.424 | 118.753
167 | 303.179 | 118.739
168 | 304.935 | 118.725
169 | 306.69 | 118.712
170 | 308.446 | 118.698
171 | 310.201 | 118.685
172 | 311.957 | 118.671
173 | 313.712 | 118.658
174 | 315.468 | 118.644
175 | 317.224 | 118.631
176 | 318.979 | 118.617
177 | 320.735 | 118.604
178 | 322.49 | 118.59
179 | 324.246 | 118.577
180 | 326.001 | 118.563
181 | 327.757 | 118.549
182 | 329.513 | 118.536
183 | 331.268 | 118.522
184 | 333.024 | 118.509
185 | 334.779 | 118.495
186 | 336.535 | 118.482
187 | 338.29 | 118.468
188 | 340.046 | 118.455
189 | 341.801 | 118.441
190 | 343.557 | 118.428
191 | 345.313 | 118.414
192 | 347.068 | 118.401
193 | 348.824 | 118.387
194 | 350.579 | 118.373
195 | 352.335 | 118.36
196 | 354.09 | 118.346
197 | 355.846 | 118.333
198 | 357.602 | 118.319
199 | 359.357 | 118.306
200 | 361.113 | 118.292
201 | 362.868 | 118.279
202 | 364.624 | 118.265
203 | 366.379 | 118.252
204 | 368.135 | 118.238
205 | 369.89 | 118.224
206 | 371.646 | 118.211
207 | 373.402 | 118.197
208 | 375.157 | 118.184
209 | 376.913 | 118.17
210 | 378.668 | 118.157
211 | 380.424 | 118.143
212 | 382.179 | 118.13
213 | 383.935 | 118.116
214 | 385.691 | 118.103
215 | 387.446 | 118.089
216 | 389.202 | 118.076
217 | 390.957 | 118.062
218 | 392.713 | 118.048
219 | 394.468 | 118.035
220 | 396.224 | 118.021
221 | 397.98 | 118.008
222 | 398.789 | 117.296
223 | 398.284 | 115.614
224 | 397.78 | 113.933
225 | 397.275 | 112.251
226 | 396.771 | 110.57
227 | 396.266 | 108.888
228 | 395.762 | 107.206
229 | 395.257 | 105.525
230 | 394.753 | 103.843
231 | 394.249 | 102.162
232 | 393.744 | 100.48
233 | 393.24 | 98.799
234 | 392.735 | 97.117
235 | 392.231 | 95.435
236 | 391.726 | 93.754
237 | 391.222 | 92.072
238 | 390.717 | 90.391
239 | 390.213 | 88.709
240 | 389.708 | 87.028
241 | 389.204 | 85.346
242 | 388.699 | 83.664
243 | 388.195 | 81.983
244 | 387.69 | 80.301
245 | 387.186 | 78.62
246 | 386.681 | 76.938
247 | 386.177 | 75.257
248 | 385.672 | 73.575
249 | 385.168 | 71.893
250 | 384.664 | 70.212
251 | 384.159 | 68.53
252 | 383.655 | 66.849
253 | 383.15 | 65.167
254 | 382.646 | 63.486
255 | 382.141 | 61.804
256 | 381.637 | 60.122
257 | 381.132 | 58.441
258 | 380.628 | 56.759
259 | 380.123 | 55.078
260 | 379.619 | 53.396
261 | 379.114 | 51.714
262 | 378.61 | 50.033
263 | 378.105 | 48.351
264 | 377.601 | 46.67
265 | 377.096 | 44.988
266 | 376.592 | 43.307
267 | 376.088 | 41.625
268 | 375.583 | 39.943
269 | 375.079 | 38.262
270 | 374.574 | 36.58
271 | 374.07 | 34.899
272 | 373.565 | 33.217
273 | 373.061 | 31.536
274 | 372.556 | 29.854
275 | 372.052 | 28.172
276 | 371.547 | 26.491
277 | 371.043 | 24.809
278 | 370.538 | 23.128
279 | 370.034 | 21.446
280 | 369.529 | 19.765
281 | 369.025 | 18.083
282 | 368.52 | 16.401
283 | 368.016 | 14.72
284 | 367.511 | 13.038
285 | 367.007 | 11.357
286 | 366.503 | 9.675
287 | 366.006 | 8.004
288 | 367.485 | 8.949
289 | 368.965 | 9.894
290 | 370.444 | 10.839
291 | 371.924 | 11.784
292 | 373.403 | 12.729
293 | 374.883 | 13.674
294 | 376.362 | 14.619
295 | 377.842 | 15.564
296 | 379.321 | 16.509
297 | 380.801 | 17.455
298 | 382.28 | 18.4
299 | 383.76 | 19.345
300 | 385.239 | 20.29
301 | 386.719 | 21.235
302 | 388.198 | 22.18
303 | 389.678 | 23.125
304 | 391.158 | 24.07
305 | 392.637 | 25.015
306 | 394.117 | 25.96
307 | 395.596 | 26.905
308 | 397.076 | 27.851
309 | 398.555 | 28.796
310 | 400.035 | 29.741
311 | 401.514 | 30.686
312 | 402.994 | 31.631
313 | 404.473 | 32.576
314 | 405.953 | 33.521
315 | 407.432 | 34.466
316 | 408.912 | 35.411
317 | 410.391 | 36.356
318 | 411.871 | 37.302
319 | 413.35 | 38.247
320 | 414.83 | 39.192
321 | 416.309 | 40.137
322 | 417.789 | 41.082
323 | 419.268 | 42.027
324 | 420.748 | 42.972
325 | 422.227 | 43.917
326 | 423.707 | 44.862
327 | 425.187 | 45.807
328 | 426.666 | 46.752
329 | 428.146 | 47.698
330 | 429.625 | 48.643
331 | 431.105 | 49.588
332 | 432.584 | 50.533
333 | 434.064 | 51.478
334 | 435.543 | 52.423
335 | 437.023 | 53.368
336 | 438.502 | 54.313
337 | 439.982 | 55.258
338 | 441.461 | 56.203
339 | 442.941 | 57.148
340 | 444.42 | 58.094
341 | 445.9 | 59.039
342 | 447.379 | 59.984
343 | 448.859 | 60.929
344 | 450.338 | 61.874
345 | 451.818 | 62.819
346 | 453.297 | 63.764
347 | 454.777 | 64.709
348 | 456.256 | 65.654
349 | 457.736 | 66.599
350 | 459.216 | 67.545
351 | 460.695 | 68.49
352 | 462.175 | 69.435
353 | 463.654 | 70.38
354 | 465.134 | 71.325
355 | 466.613 | 72.27
356 | 468.093 | 73.215
357 | 469.572 | 74.16
358 | 471.052 | 75.105
359 | 472.531 | 76.05
360 | 474.011 | 76.995
361 | 475.49 | 77.941
362 | 476.97 | 78.886
363 | 478.449 | 79.831
364 | 479.929 | 80.776
365 | 481.408 | 81.721
366 | 482.888 | 82.666
367 | 484.367 | 83.611
368 | 485.847 | 84.556
369 | 487.326 | 85.501
370 | 488.806 | 86.446
371 | 490.285 | 87.391
372 | 491.765 | 88.337
373 | 493.245 | 89.282
374 | 494.724 | 90.227
375 | 496.204 | 91.172
376 | 497.683 | 92.117
377 | 499.163 | 93.062
378 | 500.642 | 94.007
379 | 502.122 | 94.952
380 | 503.601 | 95.897
381 | 505.081 | 96.842
382 | 506.56 | 97.788
383 | 508.04 | 98.733
384 | 509.519 | 99.678
385 | 510.999 | 100.623
386 | 512.478 | 101.568
387 | 513.958 | 102.513
388 | 515.437 | 103.458
389 | 516.917 | 104.403
390 | 518.396 | 105.348
391 | 519.876 | 106.293
392 | 521.355 | 107.238
393 | 522.835 | 108.184
394 | 524.314 | 109.129
395 | 525.794 | 110.074
396 | 527.274 | 111.019
397 | 528.753 | 111.964
398 | 530.233 | 112.909
399 | 531.712 | 113.854
400 | 533.192 | 114.799
401 | 534.671 | 115.744
402 | 536.151 | 116.689
403 | 537.63 | 117.634
404 | 539.11 | 118.58
405 | 540.589 | 119.525
406 | 542.069 | 120.47
407 | 543.548 | 121.415
408 | 545.028 | 122.36
409 | 546.507 | 123.305
410 | 547.987 | 124.25
411 | 549.466 | 125.195
412 | 550.946 | 126.14
413 | 552.425 | 127.085
414 | 553.905 | 128.031
415 | 555.384 | 128.976
416 | 556.864 | 129.921
417 | 558.343 | 130.866
418 | 559.823 | 131.811
419 | 561.303 | 132.756
420 | 562.782 | 133.701
421 | 564.262 | 134.646
422 | 565.741 | 135.591
423 | 567.221 | 136.536
424 | 568.7 | 137.481
425 | 570.18 | 138.427
426 | 571.659 | 139.372
427 | 573.139 | 140.317
428 | 574.618 | 141.262
429 | 576.098 | 142.207
430 | 577.577 | 143.152
431 | 579.057 | 144.097
432 | 580.536 | 145.042
433 | 582.016 | 145.987
434 | 583.495 | 146.932
435 | 584.975 | 147.877
436 | 586.454 | 148.823
437 | 587.934 | 149.768
438 | 589.413 | 150.713
439 | 590.893 | 151.658
440 | 592.372 | 152.603
441 | 593.852 | 153.548
442 | 595.332 | 154.493
443 | 596.811 | 155.438
444 | 598.291 | 156.383
445 | 599.77 | 157.328
446 | 601.25 | 158.274
447 | 602.729 | 159.219
448 | 604.209 | 160.164
449 | 605.688 | 161.109
450 | 607.168 | 162.054
451 | 608.647 | 162.999
452 | 610.127 | 163.944
453 | 611.606 | 164.889
454 | 613.086 | 165.834
455 | 614.565 | 166.779
456 | 616.045 | 167.724
457 | 617.524 | 168.67
458 | 619.004 | 169.615
459 | 620.483 | 170.56
460 | 621.963 | 171.505
461 | 623.442 | 172.45
462 | 624.922 | 173.395
463 | 626.401 | 174.34
464 | 627.881 | 175.285
465 | 628.656 | 176.255
466 | 627.246 | 177.3
467 | 625.835 | 178.345
468 | 624.424 | 179.39
469 | 623.014 | 180.435
470 | 621.603 | 181.48
471 | 620.192 | 182.525
472 | 618.782 | 183.571
473 | 617.371 | 184.616
474 | 615.961 | 185.661
475 | 614.55 | 186.706
476 | 613.139 | 187.751
477 | 611.729 | 188.796
478 | 610.318 | 189.841
479 | 608.907 | 190.886
480 | 607.497 | 191.932
481 | 606.086 | 192.977
482 | 604.675 | 194.022
483 | 603.265 | 195.067
484 | 601.854 | 196.112
485 | 600.444 | 197.157
486 | 599.033 | 198.202
487 | 597.622 | 199.247
488 | 596.212 | 200.293
489 | 594.801 | 201.338
490 | 593.39 | 202.383
491 | 591.98 | 203.428
492 | 590.569 | 204.473
493 | 589.158 | 205.518
494 | 587.748 | 206.563
495 | 586.337 | 207.608
496 | 584.927 | 208.654
497 | 583.516 | 209.699
498 | 582.105 | 210.744
499 | 580.695 | 211.789
500 | 579.284 | 212.834
501 | 577.873 | 213.879
502 | 576.463 | 214.924
503 | 575.052 | 215.97
504 | 573.641 | 217.015
505 | 572.231 | 218.06
506 | 570.82 | 219.105
507 | 569.41 | 220.15
508 | 567.999 | 221.195
509 | 566.588 | 222.24
510 | 565.178 | 223.285
511 | 563.767 | 224.331
512 | 562.356 | 225.376
513 | 560.946 | 226.421
514 | 559.535 | 227.466
515 | 558.124 | 228.511
516 | 556.714 | 229.556
517 | 555.303 | 230.601
518 | 553.893 | 231.646
519 | 552.482 | 232.692
520 | 551.071 | 233.737
521 | 549.661 | 234.782
522 | 548.25 | 235.827
523 | 546.839 | 236.872
524 | 545.429 | 237.917
525 | 544.018 | 238.962
526 | 542.607 | 240.007
527 | 541.197 | 241.053
528 | 539.786 | 242.098
529 | 538.376 | 243.143
530 | 536.965 | 244.188
531 | 535.554 | 245.233
532 | 534.144 | 246.278
533 | 532.733 | 247.323
534 | 531.322 | 248.368
535 | 529.912 | 249.414
536 | 528.501 | 250.459
537 | 527.09 | 251.504
538 | 525.68 | 252.549
539 | 524.269 | 253.594
540 | 522.859 | 254.639
541 | 521.448 | 255.684
542 | 520.037 | 256.729
543 | 518.627 | 257.775
544 | 517.216 | 258.82
545 | 515.805 | 259.865
546 | 514.395 | 260.91
547 | 512.984 | 261.955
548 | 511.573 | 263
549 | 510.163 | 264.045
550 | 508.752 | 265.09
551 | 507.342 | 266.136
552 | 505.931 | 267.181
553 | 504.52 | 268.226
554 | 503.11 | 269.271
555 | 501.699 | 270.316
556 | 500.288 | 271.361
557 | 498.878 | 272.406
558 | 497.467 | 273.452
559 | 496.056 | 274.497
560 | 494.646 | 275.542
561 | 493.235 | 276.587
562 | 491.825 | 277.632
563 | 490.414 | 278.677
564 | 489.003 | 279.722
565 | 487.593 | 280.767
566 | 486.182 | 281.813
567 | 484.771 | 282.858
568 | 483.361 | 283.903
569 | 481.95 | 284.948
570 | 480.539 | 285.993
571 | 479.129 | 287.038
572 | 477.718 | 288.083
573 | 476.308 | 289.128
574 | 474.897 | 290.174
575 | 473.486 | 291.219
576 | 472.076 | 292.264
577 | 470.665 | 293.309
578 | 469.254 | 294.354
579 | 467.844 | 295.399
580 | 466.433 | 296.444
581 | 465.022 | 297.489
582 | 463.612 | 298.535
583 | 462.201 | 299.58
584 | 460.791 | 300.625
585 | 459.38 | 301.67
586 | 457.969 | 302.715
587 | 456.559 | 303.76
588 | 455.148 | 304.805
589 | 453.737 | 305.85
590 | 452.327 | 306.896
591 | 450.916 | 307.941
592 | 449.505 | 308.986
593 | 448.095 | 310.031
594 | 446.684 | 311.076
595 | 445.274 | 312.121
596 | 443.863 | 313.166
597 | 442.452 | 314.211
598 | 441.042 | 315.257
599 | 439.631 | 316.302
600 | 438.22 | 317.347
601 | 436.81 | 318.392
602 | 435.399 | 319.437
603 | 433.988 | 320.482
604 | 432.578 | 321.527
605 | 431.167 | 322.572
606 | 429.757 | 323.618
607 | 428.346 | 324.663
608 | 426.935 | 325.708
609 | 425.525 | 326.753
610 | 424.114 | 327.798
611 | 422.703 | 328.843
612 | 421.293 | 329.888
613 | 419.882 | 330.934
614 | 418.471 | 331.979
615 | 417.061 | 333.024
616 | 415.65 | 334.069
617 | 414.24 | 335.114
618 | 412.829 | 336.159
619 | 411.418 | 337.204
620 | 410.008 | 338.249
621 | 408.597 | 339.295
622 | 407.186 | 340.34
623 | 405.776 | 341.385
624 | 404.365 | 342.43
625 | 402.954 | 343.475
626 | 401.544 | 344.52
627 | 400.133 | 345.565
628 | 398.723 | 346.61
629 | 397.312 | 347.656
630 | 395.901 | 348.701
631 | 394.491 | 349.746
632 | 393.08 | 350.791
633 | 391.669 | 351.836
634 | 390.259 | 352.881
635 | 388.848 | 353.926
636 | 387.437 | 354.971
637 | 386.027 | 356.017
638 | 384.616 | 357.062
639 | 383.206 | 358.107
640 | 382.043 | 358.748
641 | 382.337 | 357.018
642 | 382.631 | 355.287
643 | 382.924 | 353.556
644 | 383.218 | 351.825
645 | 383.512 | 350.094
646 | 383.806 | 348.363
647 | 384.1 | 346.632
648 | 384.394 | 344.902
649 | 384.688 | 343.171
650 | 384.982 | 341.44
651 | 385.276 | 339.709
652 | 385.57 | 337.978
653 | 385.864 | 336.247
654 | 386.158 | 334.517
655 | 386.451 | 332.786
656 | 386.745 | 331.055
657 | 387.039 | 329.324
658 | 387.333 | 327.593
659 | 387.627 | 325.862
660 | 387.921 | 324.132
661 | 388.215 | 322.401
662 | 388.509 | 320.67
663 | 388.803 | 318.939
664 | 389.097 | 317.208
665 | 389.391 | 315.477
666 | 389.685 | 313.747
667 | 389.978 | 312.016
668 | 390.272 | 310.285
669 | 390.566 | 308.554
670 | 390.86 | 306.823
671 | 391.154 | 305.092
672 | 391.448 | 303.362
673 | 391.742 | 301.631
674 | 392.036 | 299.9
675 | 392.33 | 298.169
676 | 392.624 | 296.438
677 | 392.918 | 294.707
678 | 393.212 | 292.977
679 | 393.505 | 291.246
680 | 393.799 | 289.515
681 | 394.093 | 287.784
682 | 394.387 | 286.053
683 | 394.681 | 284.322
684 | 394.975 | 282.592
685 | 395.269 | 280.861
686 | 395.563 | 279.13
687 | 395.857 | 277.399
688 | 396.151 | 275.668
689 | 396.445 | 273.937
690 | 396.739 | 272.206
691 | 397.032 | 270.476
692 | 397.326 | 268.745
693 | 397.62 | 267.014
694 | 397.914 | 265.283
695 | 398.208 | 263.552
696 | 398.502 | 261.821
697 | 398.796 | 260.091
698 | 399.09 | 258.36
699 | 399.384 | 256.629
700 | 399.678 | 254.898
701 | 399.972 | 253.167
702 | 398.414 | 253
703 | 396.658 | 253
704 | 394.903 | 253
705 | 393.147 | 253
706 | 391.392 | 253
707 | 389.636 | 253
708 | 387.88 | 253
709 | 386.125 | 253
710 | 384.369 | 253
711 | 382.613 | 253
712 | 380.858 | 253
713 | 379.102 | 253
714 | 377.347 | 253
715 | 375.591 | 253
716 | 373.835 | 253
717 | 372.08 | 253
718 | 370.324 | 253
719 | 368.569 | 253
720 | 366.813 | 253
721 | 365.057 | 253
722 | 363.302 | 253
723 | 361.546 | 253
724 | 359.79 | 253
725 | 358.035 | 253
726 | 356.279 | 253
727 | 354.524 | 253
728 | 352.768 | 253
729 | 351.012 | 253
730 | 349.257 | 253
731 | 347.501 | 253
732 | 345.746 | 253
733 | 343.99 | 253
734 | 342.234 | 253
735 | 340.479 | 253
736 | 338.723 | 253
737 | 336.967 | 253
738 | 335.212 | 253
739 | 333.456 | 253
740 | 331.701 | 253
741 | 329.945 | 253
742 | 328.189 | 253
743 | 326.434 | 253
744 | 324.678 | 253
745 | 322.923 | 253
746 | 321.167 | 253
747 | 319.411 | 253
748 | 317.656 | 253
749 | 315.9 | 253
750 | 314.144 | 253
751 | 312.389 | 253
752 | 310.633 | 253
753 | 308.878 | 253
754 | 307.122 | 253
755 | 305.366 | 253
756 | 303.611 | 253
757 | 301.855 | 253
758 | 300.1 | 253
759 | 298.344 | 253
760 | 296.588 | 253
761 | 294.833 | 253
762 | 293.077 | 253
763 | 291.321 | 253
764 | 289.566 | 253
765 | 287.81 | 253
766 | 286.055 | 253
767 | 284.299 | 253
768 | 282.543 | 253
769 | 280.788 | 253
770 | 279.032 | 253
771 | 277.277 | 253
772 | 275.521 | 253
773 | 273.765 | 253
774 | 272.01 | 253
775 | 270.254 | 253
776 | 268.498 | 253
777 | 266.743 | 253
778 | 264.987 | 253
779 | 263.232 | 253
780 | 261.476 | 253
781 | 259.72 | 253
782 | 257.965 | 253
783 | 256.209 | 253
784 | 254.454 | 253
785 | 252.698 | 253
786 | 250.942 | 253
787 | 249.187 | 253
788 | 247.431 | 253
789 | 245.675 | 253
790 | 243.92 | 253
791 | 242.164 | 253
792 | 240.409 | 253
793 | 238.653 | 253
794 | 236.897 | 253
795 | 235.142 | 253
796 | 233.386 | 253
797 | 231.631 | 253
798 | 229.875 | 253
799 | 228.119 | 253
800 | 226.364 | 253
801 | 224.608 | 253
802 | 222.852 | 253
803 | 221.097 | 253
804 | 219.341 | 253
805 | 217.586 | 253
806 | 215.83 | 253
807 | 214.074 | 253
808 | 212.319 | 253
809 | 210.563 | 253
810 | 208.808 | 253
811 | 207.052 | 253
812 | 205.296 | 253
813 | 203.541 | 253
814 | 201.785 | 253
815 | 200.029 | 253
816 | 198.274 | 253
817 | 196.518 | 253
818 | 194.763 | 253
819 | 193.007 | 253
820 | 191.251 | 253
821 | 189.496 | 253
822 | 187.74 | 253
823 | 185.985 | 253
824 | 184.229 | 253
825 | 182.473 | 253
826 | 180.718 | 253
827 | 178.962 | 253
828 | 177.206 | 253
829 | 175.451 | 253
830 | 173.695 | 253
831 | 171.94 | 253
832 | 170.184 | 253
833 | 168.428 | 253
834 | 166.673 | 253
835 | 164.917 | 253
836 | 163.162 | 253
837 | 161.406 | 253
838 | 159.65 | 253
839 | 157.895 | 253
840 | 156.139 | 253
841 | 154.383 | 253
842 | 152.628 | 253
843 | 150.872 | 253
844 | 149.117 | 253
845 | 147.361 | 253
846 | 145.605 | 253
847 | 143.85 | 253
848 | 142.094 | 253
849 | 140.339 | 253
850 | 138.583 | 253
851 | 136.827 | 253
852 | 135.072 | 253
853 | 133.316 | 253
854 | 131.56 | 253
855 | 129.805 | 253
856 | 128.049 | 253
857 | 126.294 | 253
858 | 124.538 | 253
859 | 122.782 | 253
860 | 121.027 | 253
861 | 119.271 | 253
862 | 117.516 | 253
863 | 115.76 | 253
864 | 114.004 | 253
865 | 112.249 | 253
866 | 110.493 | 253
867 | 108.737 | 253
868 | 106.982 | 253
869 | 105.226 | 253
870 | 103.471 | 253
871 | 101.715 | 253
872 | 99.959 | 253
873 | 98.204 | 253
874 | 96.448 | 253
875 | 94.693 | 253
876 | 92.937 | 253
877 | 91.181 | 253
878 | 89.426 | 253
879 | 87.67 | 253
880 | 85.914 | 253
881 | 84.159 | 253
882 | 82.403 | 253
883 | 80.648 | 253
884 | 78.892 | 253
885 | 77.136 | 253
886 | 75.381 | 253
887 | 73.625 | 253
888 | 71.87 | 253
889 | 70.114 | 253
890 | 68.358 | 253
891 | 66.603 | 253
892 | 64.847 | 253
893 | 63.091 | 253
894 | 61.336 | 253
895 | 59.58 | 253
896 | 57.825 | 253
897 | 56.069 | 253
898 | 54.313 | 253
899 | 52.558 | 253
900 | 50.802 | 253
901 | 49.047 | 253
902 | 47.291 | 253
903 | 45.535 | 253
904 | 43.78 | 253
905 | 42.024 | 253
906 | 40.268 | 253
907 | 38.513 | 253
908 | 36.757 | 253
909 | 35.002 | 253
910 | 33.246 | 253
911 | 31.49 | 253
912 | 29.735 | 253
913 | 27.979 | 253
914 | 26.224 | 253
915 | 24.468 | 253
916 | 22.712 | 253
917 | 20.957 | 253
918 | 19.201 | 253
919 | 17.445 | 253
920 | 15.69 | 253
921 | 13.934 | 253
922 | 12.179 | 253
923 | 10.423 | 253
924 | 9.003 | 252.667
925 | 9.016 | 250.912
926 | 9.029 | 249.156
927 | 9.042 | 247.401
928 | 9.056 | 245.645
929 | 9.069 | 243.89
930 | 9.082 | 242.134
931 | 9.096 | 240.378
932 | 9.109 | 238.623
933 | 9.122 | 236.867
934 | 9.136 | 235.112
935 | 9.149 | 233.356
936 | 9.162 | 231.601
937 | 9.175 | 229.845
938 | 9.189 | 228.089
939 | 9.202 | 226.334
940 | 9.215 | 224.578
941 | 9.229 | 222.823
942 | 9.242 | 221.067
943 | 9.255 | 219.312
944 | 9.269 | 217.556
945 | 9.282 | 215.801
946 | 9.295 | 214.045
947 | 9.308 | 212.289
948 | 9.322 | 210.534
949 | 9.335 | 208.778
950 | 9.348 | 207.023
951 | 9.362 | 205.267
952 | 9.375 | 203.512
953 | 9.388 | 201.756
954 | 9.402 | 200
955 | 9.415 | 198.245
956 | 9.428 | 196.489
957 | 9.441 | 194.734
958 | 9.455 | 192.978
959 | 9.468 | 191.223
960 | 9.481 | 189.467
961 | 9.495 | 187.711
962 | 9.508 | 185.956
963 | 9.521 | 184.2
964 | 9.535 | 182.445
965 | 9.548 | 180.689
966 | 9.561 | 178.934
967 | 9.574 | 177.178
968 | 9.588 | 175.423
969 | 9.601 | 173.667
970 | 9.614 | 171.911
971 | 9.628 | 170.156
972 | 9.641 | 168.4
973 | 9.654 | 166.645
974 | 9.668 | 164.889
975 | 9.681 | 163.134
976 | 9.694 | 161.378
977 | 9.707 | 159.622
978 | 9.721 | 157.867
979 | 9.734 | 156.111
980 | 9.747 | 154.356
981 | 9.761 | 152.6
982 | 9.774 | 150.845
983 | 9.787 | 149.089
984 | 9.801 | 147.333
985 | 9.814 | 145.578
986 | 9.827 | 143.822
987 | 9.84 | 142.067
988 | 9.854 | 140.311
989 | 9.867 | 138.556
990 | 9.88 | 136.8
991 | 9.894 | 135.045
992 | 9.907 | 133.289
993 | 9.92 | 131.533
994 | 9.934 | 129.778
995 | 9.947 | 128.022
996 | 9.96 | 126.267
997 | 9.973 | 124.511
998 | 9.987 | 122.756
999 | 10 | 121
}
"""

# Process the data
coordinates = parse_coordinates(data_text)
x_filtered, y_filtered = process_coordinates(coordinates)
x_dac, y_dac = scale_for_dac(x_filtered, y_filtered)
generate_stm32_header(x_dac, y_dac)

print("Processing complete! Generated 'arrow_data.h' for STM32.")
print(f"Original points: {len(coordinates)}")
print(f"Filtered points: {len(x_filtered)}")
print(f"DAC range: X=[{min(x_dac)}, {max(x_dac)}], Y=[{min(y_dac)}, {max(y_dac)}]")